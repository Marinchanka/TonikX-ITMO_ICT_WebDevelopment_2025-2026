
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../practical_work/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Лабораторная работа - Лабораторные работы по Web-программированию</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#no3-django-rest-api" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href=".." title="Лабораторные работы по Web-программированию" class="md-header__button md-logo" aria-label="Лабораторные работы по Web-программированию" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Лабораторные работы по Web-программированию
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Лабораторная работа
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Лабораторные работы по Web-программированию" class="md-nav__button md-logo" aria-label="Лабораторные работы по Web-программированию" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Лабораторные работы по Web-программированию
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Лабораторная работа №1
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Лабораторная работа №1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Главная
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../task1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Задание 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../task2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Задание 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../task3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Задание 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../task4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Задание 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../task5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Задание 5
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Лабораторная работа №2
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Лабораторная работа №3
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Лабораторная работа №3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../practical_work/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Практическая работа 3.1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Лабораторная работа
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Лабораторная работа
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      10 Вариант:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      Реализация проекта:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Реализация проекта:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-djangoorm" class="md-nav__link">
    <span class="md-ellipsis">
      1. Модель базы данных средствами DjangoORM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-api-django-rest-framework" class="md-nav__link">
    <span class="md-ellipsis">
      2. Работа API средствами Django REST Framework
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-djoser" class="md-nav__link">
    <span class="md-ellipsis">
      3. Подключение регистрации / авторизации по токенам / вывод информации о текущем пользователе средствами Djoser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-djoser" class="md-nav__link">
    <span class="md-ellipsis">
      4. Эндпоинты аутентификации и регистрации (Djoser)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Эндпоинты аутентификации и регистрации (Djoser)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      Важные по заданию:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-post-authusers" class="md-nav__link">
    <span class="md-ellipsis">
      1. POST /auth/users/
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-post-authjwtcreate" class="md-nav__link">
    <span class="md-ellipsis">
      2. POST /auth/jwt/create/
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-get-authusersme" class="md-nav__link">
    <span class="md-ellipsis">
      3. GET /auth/users/me/
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-api-crud" class="md-nav__link">
    <span class="md-ellipsis">
      5. Эндпоинты API клиники (CRUD)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      10 Вариант:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      Реализация проекта:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Реализация проекта:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-djangoorm" class="md-nav__link">
    <span class="md-ellipsis">
      1. Модель базы данных средствами DjangoORM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-api-django-rest-framework" class="md-nav__link">
    <span class="md-ellipsis">
      2. Работа API средствами Django REST Framework
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-djoser" class="md-nav__link">
    <span class="md-ellipsis">
      3. Подключение регистрации / авторизации по токенам / вывод информации о текущем пользователе средствами Djoser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-djoser" class="md-nav__link">
    <span class="md-ellipsis">
      4. Эндпоинты аутентификации и регистрации (Djoser)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Эндпоинты аутентификации и регистрации (Djoser)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      Важные по заданию:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-post-authusers" class="md-nav__link">
    <span class="md-ellipsis">
      1. POST /auth/users/
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-post-authjwtcreate" class="md-nav__link">
    <span class="md-ellipsis">
      2. POST /auth/jwt/create/
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-get-authusersme" class="md-nav__link">
    <span class="md-ellipsis">
      3. GET /auth/users/me/
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-api-crud" class="md-nav__link">
    <span class="md-ellipsis">
      5. Эндпоинты API клиники (CRUD)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="no3-django-rest-api">Лабораторная работа №3. Реализация серверной части на django rest. Документирование API..</h1>
<hr />
<p><strong>Автор:</strong> Машковцева Марина</p>
<hr />
<p><strong>Цель:</strong> овладеть практическими навыками и умениями реализации web-сервисов
средствами Django.</p>
<h2 id="10">10 Вариант:</h2>
<p>Создать программную систему, предназначенную для администратора лечебной
клиники.</p>
<p>Прием пациентов ведут несколько врачей различных специализаций. На каждого
пациента клиники заводится медицинская карта, в которой отражается вся
информация по личным данным больного и истории его заболеваний (диагнозы). При
очередном посещении врача в карте отражается дата и время приема, диагноз, текущее
состояние больного, рекомендации по лечению. Так как прием ведется только на
коммерческой основе, после очередного посещения пациент должен оплатить
медицинские услуги (каждый прием оплачивается отдельно). Расчет стоимости
посещения определяется врачом согласно прейскуранту по клинике.</p>
<p>Для ведения внутренней отчетности необходима следующая информация о врач:
фамилия, имя, отчество, специальность, образование, пол, дата рождения и дата начала
и окончания работы в клинике, данные по трудовому договору. Для каждого врача
составляется график работы с указанием рабочих и выходных дней.</p>
<p>Прием пациентов врачи могут вести в разных кабинетах. Каждый кабинет имеет
определенный режим работы, ответственного и внутренний телефон.</p>
<h2 id="_1">Реализация проекта:</h2>
<h3 id="1-djangoorm">1. Модель базы данных средствами DjangoORM</h3>
<p>Сначала была реализована диаграмма, наглядно демонстрирующая все связи будущей БД:
<img alt="БД" src="../images/%D0%94%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%2010%20%D0%B2%D0%B0%D1%80.png" />
Затем она же была реализована в проекте:</p>
<pre><code class="language-python">
class Patient(models.Model):
    last_name = models.CharField(max_length=100)
    first_name = models.CharField(max_length=100)
    middle_name = models.CharField(max_length=100, blank=True, null=True)
    birth_date = models.DateField()
    phone = models.CharField(max_length=20, blank=True, null=True)
    address = models.CharField(max_length=255, blank=True, null=True)
    passport_data = models.CharField(max_length=100, blank=True, null=True)

    def __str__(self):
        return f&quot;{self.last_name} {self.first_name}&quot;

class Doctor(models.Model):
    last_name = models.CharField(max_length=100)
    first_name = models.CharField(max_length=100)
    middle_name = models.CharField(max_length=100, blank=True, null=True)
    specialty = models.CharField(max_length=100)
    education = models.CharField(max_length=255, blank=True, null=True)
    gender = models.CharField(max_length=10, blank=True, null=True)
    birth_date = models.DateField(blank=True, null=True)
    work_start_date = models.DateField()
    work_end_date = models.DateField(blank=True, null=True)
    contract_info = models.TextField(blank=True, null=True)

    def __str__(self):
        return f&quot;Dr. {self.last_name} ({self.specialty})&quot;

class DoctorSchedule(models.Model):
    doctor = models.ForeignKey(Doctor, on_delete=models.CASCADE, related_name='schedules')
    work_date = models.DateField()
    is_working = models.BooleanField(default=True)

    class Meta:
        unique_together = ('doctor', 'work_date')

    def __str__(self):
        return f&quot;{self.doctor} - {self.work_date} {'work' if self.is_working else 'off'}&quot;

class Room(models.Model):
    room_number = models.CharField(max_length=20)
    work_time_start = models.TimeField()
    work_time_end = models.TimeField()
    responsible_person = models.CharField(max_length=100, blank=True, null=True)
    internal_phone = models.CharField(max_length=20, blank=True, null=True)

    def __str__(self):
        return f&quot;Room {self.room_number}&quot;

class MedicalRecord(models.Model):
    patient = models.OneToOneField(Patient, on_delete=models.CASCADE, related_name='medical_record')
    create_date = models.DateField(auto_now_add=True)

    def __str__(self):
        return f&quot;MR:{self.patient}&quot;

class Visit(models.Model):
    record = models.ForeignKey(MedicalRecord, on_delete=models.CASCADE, related_name='visits')
    doctor = models.ForeignKey(Doctor, on_delete=models.CASCADE, related_name='visits')
    room = models.ForeignKey(Room, on_delete=models.SET_NULL, null=True, blank=True, related_name='visits')
    visit_datetime = models.DateTimeField()
    diagnosis = models.TextField(blank=True, null=True)
    patient_condition = models.TextField(blank=True, null=True)
    recommendations = models.TextField(blank=True, null=True)
    price = models.DecimalField(max_digits=10, decimal_places=2)

    def __str__(self):
        return f&quot;Visit {self.id} - {self.record.patient} @ {self.visit_datetime}&quot;

class Payment(models.Model):
    visit = models.OneToOneField(Visit, on_delete=models.CASCADE, related_name='payment')
    payment_datetime = models.DateTimeField(auto_now_add=True)
    amount = models.DecimalField(max_digits=10, decimal_places=2)
    payment_method = models.CharField(max_length=50, blank=True, null=True)

    def __str__(self):
        return f&quot;Payment {self.id} - visit {self.visit_id}&quot;
</code></pre>
<h3 id="2-api-django-rest-framework">2. Работа API средствами Django REST Framework</h3>
<p>Были созданы ModelSerializer-ы для каждой модели:</p>
<pre><code class="language-python">from rest_framework import serializers
from .models import Patient, Doctor, DoctorSchedule, Room, MedicalRecord, Visit, Payment

class PatientSerializer(serializers.ModelSerializer):
    class Meta:
        model = Patient
        fields = &quot;__all__&quot;

class DoctorSerializer(serializers.ModelSerializer):
    class Meta:
        model = Doctor
        fields = &quot;__all__&quot;

class DoctorScheduleSerializer(serializers.ModelSerializer):
    class Meta:
        model = DoctorSchedule
        fields = &quot;__all__&quot;

class RoomSerializer(serializers.ModelSerializer):
    class Meta:
        model = Room
        fields = &quot;__all__&quot;

class MedicalRecordSerializer(serializers.ModelSerializer):
    patient = PatientSerializer(read_only=True)
    class Meta:
        model = MedicalRecord
        fields = &quot;__all__&quot;

class VisitSerializer(serializers.ModelSerializer):
    record = MedicalRecordSerializer(read_only=True)
    record_id = serializers.PrimaryKeyRelatedField(queryset=MedicalRecord.objects.all(), source='record', write_only=True)
    class Meta:
        model = Visit
        fields = [&quot;id&quot;,&quot;record&quot;,&quot;record_id&quot;,&quot;doctor&quot;,&quot;room&quot;,&quot;visit_datetime&quot;,&quot;diagnosis&quot;,&quot;patient_condition&quot;,&quot;recommendations&quot;,&quot;price&quot;]

class PaymentSerializer(serializers.ModelSerializer):
    visit = VisitSerializer(read_only=True)
    visit_id = serializers.PrimaryKeyRelatedField(queryset=Visit.objects.all(), source='visit', write_only=True)
    class Meta:
        model = Payment
        fields = [&quot;id&quot;,&quot;visit&quot;,&quot;visit_id&quot;,&quot;payment_datetime&quot;,&quot;amount&quot;,&quot;payment_method&quot;]
</code></pre>
<p>Здесь мы превращаем модели в JSON и обратно, валидируем данные.</p>
<p>А также прописаны ViewSet-ы для каждой модели:</p>
<pre><code class="language-python">from rest_framework import viewsets, filters, status
from .models import Patient, Doctor, DoctorSchedule, Room, MedicalRecord, Visit, Payment
from .serializers import PatientSerializer, DoctorSerializer, DoctorScheduleSerializer, RoomSerializer, MedicalRecordSerializer, VisitSerializer, PaymentSerializer

class PatientViewSet(viewsets.ModelViewSet):
    queryset = Patient.objects.all().order_by('last_name')
    serializer_class = PatientSerializer
    filter_backends = [filters.SearchFilter, filters.OrderingFilter]
    search_fields = ['last_name','first_name','phone']
    ordering_fields = ['last_name','birth_date']

class DoctorViewSet(viewsets.ModelViewSet):
    queryset = Doctor.objects.all()
    serializer_class = DoctorSerializer

class VisitViewSet(viewsets.ModelViewSet):
    queryset = Visit.objects.select_related('doctor','record__patient','room').all()
    serializer_class = VisitSerializer

class PaymentViewSet(viewsets.ModelViewSet):
    queryset = Payment.objects.select_related('visit__record__patient').all()
    serializer_class = PaymentSerializer
</code></pre>
<p>Здесь мы подключаем сериалайзеры и модели, реализуем CRUD (create / read / update / delete).</p>
<p>И в <code>clinic/urls.py</code> подключаем все ViewSet'ы через router:</p>
<pre><code class="language-python">router = DefaultRouter()
router.register('patients', PatientViewSet)
router.register('doctors', DoctorViewSet)
</code></pre>
<p>Здесь создаются все эндпоинты автоматически.</p>
<h3 id="3-djoser">3. Подключение регистрации / авторизации по токенам / вывод информации о текущем пользователе средствами Djoser</h3>
<p>Подключаем Djoser приложение и JWT в <code>settings.py</code>:</p>
<pre><code class="language-python">INSTALLED_APPS = [
    'rest_framework',
    'rest_framework_simplejwt',
    'djoser',
]
</code></pre>
<p>Настройки в разделе REST_FRAMEWORK:</p>
<pre><code class="language-python">REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ),
}
</code></pre>
<p>Здесь мы говорим использовать JWT токены как метод авторизации.</p>
<p>Настройки DJOSER:</p>
<pre><code class="language-python">DJOSER = {
    'USER_CREATE_PASSWORD_RETYPE': True,
}
</code></pre>
<p>Здесь включаем регистрацию + повтор ввода пароля.</p>
<p>Далее в файле <code>urls.py</code> подключаются маршруты Djoser:</p>
<pre><code class="language-python">path('auth/', include('djoser.urls')),
path('auth/', include('djoser.urls.jwt')),
</code></pre>
<h3 id="4-djoser">4. Эндпоинты аутентификации и регистрации (Djoser)</h3>
<h4 id="_2">Важные по заданию:</h4>
<h4 id="1-post-authusers">1. POST /auth/users/</h4>
<pre><code>Создаёт нового пользователя системы.
Требуется только для того, чтобы иметь возможность войти и получить токен.
</code></pre>
<h4 id="2-post-authjwtcreate">2. POST /auth/jwt/create/</h4>
<pre><code>Пользователь вводит логин/пароль, сервер отдаёт:
access-токен
refresh-токен
</code></pre>
<h4 id="3-get-authusersme">3. GET /auth/users/me/</h4>
<pre><code>Работает только если отправлен Authorization: Bearer &lt;token&gt;.
Используется для проверки:
— корректен ли токен
— кто сейчас авторизован
</code></pre>
<p>Djoser автоматически генерирует дополнительные эндпоинты для сброса пароля, проверки токена, обновления токена, активации аккаунта и других функций.</p>
<p>В рамках данного задания они не используются, но присутствуют, так как являются частью стандартного функционала Djoser.</p>
<h3 id="5-api-crud">5. Эндпоинты API клиники (CRUD)</h3>
<p>Каждый ViewSet даёт 5 методов:</p>
<ul>
<li>
<p>GET /api/'&lt;'model'&gt;'/ — список записей</p>
</li>
<li>
<p>POST /api/'&lt;'model'&gt;'/ — создание</p>
</li>
<li>
<p>GET /api/'&lt;'model'&gt;'/{id}/ — просмотр одной</p>
</li>
<li>
<p>PUT/PATCH /api/'&lt;'model'&gt;'/{id}/ — обновление</p>
</li>
<li>
<p>DELETE /api/'&lt;'model'&gt;'/{id}/ — удаление</p>
</li>
</ul>
<p>Все защищены авторизацией, то есть требуют токена.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>